CREATE DATABASE carpooldb;
USE carpooldb;

CREATE TABLE cities (
  id int NOT NULL,
  city VARCHAR(20) NOT NULL,
  PRIMARY KEY (id)
);

CREATE TABLE users (
  id int NOT NULL UNIQUE AUTO_INCREMENT,
  username varchar(20) UNIQUE NOT NULL,
  password varchar(20) NOT NULL,
  admin varchar(1) DEFAULT NULL,	-- Y if admin account, Null if not
  PRIMARY KEY (id)
)

CREATE TABLE trips (
  id int NOT NULL AUTO_INCREMENT,
  driver_id int DEFAULT NULL,		-- Null if trip is put up by driver
  req_id int DEFAULT NULL,		-- Null if trip is put up by driver
  departure_location int DEFAULT NULL,
  arrival_location int DEFAULT NULL,
  departure_date date DEFAULT NULL,
  departure_time time DEFAULT NULL,
  seats_available int DEFAULT NULL,
  status enum('available','full','pending') DEFAULT 'available',
  created_at timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (id),
  KEY departure_location (departure_location),
  KEY arrival_location (arrival_location),
  CONSTRAINT trips_ibfk_1 FOREIGN KEY (departure_location) REFERENCES cities (id),
  CONSTRAINT trips_ibfk_2 FOREIGN KEY (arrival_location) REFERENCES cities (id)
);

CREATE TABLE trip_bookings (
  id int NOT NULL AUTO_INCREMENT,
  trip_id int DEFAULT NULL,
  passenger_id int DEFAULT NULL,
  seats_taken int DEFAULT NULL,
  PRIMARY KEY (id),
  KEY trip_id (trip_id),
  KEY passenger_id (passenger_id),
  CONSTRAINT trip_bookings_ibfk_1 FOREIGN KEY (trip_id) REFERENCES trips (id),
  CONSTRAINT trip_bookings_ibfk_2 FOREIGN KEY (passenger_id) REFERENCES users (id)
);

INSERT INTO users(username, password, admin) VALUES ('admin', 'admin', 'Y');	-- Add admin account

-- Add cities
INSERT INTO carpooldb.cities (id, city) VALUES (1 ,"Ajax" );
INSERT INTO carpooldb.cities (id, city) VALUES (2 ,"Aurora" );
INSERT INTO carpooldb.cities (id, city) VALUES (3 ,"Brampton" );
INSERT INTO carpooldb.cities (id, city) VALUES (4 ,"Brock" );
INSERT INTO carpooldb.cities (id, city) VALUES (5 ,"Burlington" );
INSERT INTO carpooldb.cities (id, city) VALUES (6 ,"Caledon" );
INSERT INTO carpooldb.cities (id, city) VALUES (7 ,"Clarington" );
INSERT INTO carpooldb.cities (id, city) VALUES (8 ,"East Gwillimbury" );
INSERT INTO carpooldb.cities (id, city) VALUES (9 ,"Georgina" );
INSERT INTO carpooldb.cities (id, city) VALUES (10,"Halton Hills" );
INSERT INTO carpooldb.cities (id, city) VALUES (11,"King" );
INSERT INTO carpooldb.cities (id, city) VALUES (12,"Markham" );
INSERT INTO carpooldb.cities (id, city) VALUES (13,"Milton" );
INSERT INTO carpooldb.cities (id, city) VALUES (14,"Mississauga" );
INSERT INTO carpooldb.cities (id, city) VALUES (15,"Newmarket" );
INSERT INTO carpooldb.cities (id, city) VALUES (16,"Oakville" );
INSERT INTO carpooldb.cities (id, city) VALUES (17,"Oshawa" );
INSERT INTO carpooldb.cities (id, city) VALUES (18,"Pickering" );
INSERT INTO carpooldb.cities (id, city) VALUES (19,"Richmond Hill" );
INSERT INTO carpooldb.cities (id, city) VALUES (20,"Scugog" );
INSERT INTO carpooldb.cities (id, city) VALUES (21,"Toronto" );
INSERT INTO carpooldb.cities (id, city) VALUES (22,"Uxbridge" );
INSERT INTO carpooldb.cities (id, city) VALUES (23,"Vaughan" );
INSERT INTO carpooldb.cities (id, city) VALUES (24,"Whitby" );
INSERT INTO carpooldb.cities (id, city) VALUES (25,"Stouffville" );